<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>RGB config</title>

</head>
<body>

<input type="color" id="color" value="#ff0000"/>
<textarea placeholder="Тут будет результат" id="result"></textarea>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.0.4/jscolor.min.js"
        integrity="sha256-CJWfUCeP3jLdUMVNUll6yQx37gh9AKmXTRxvRf7jzro=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript">
  $(document).ready(() => {
    let drawing = false;
    const key = v => ({code}) => {
      if (code === 'Space') {
        drawing = v;
      }
    };

    const frames = [];
    const refreshResult = () => $('#result').val(JSON.stringify(frames));
    refreshResult();

    const rgbToHex = s => {
      const {red, green, blue} = s
        .match(/rgb\((?<red>\d+),\s*(?<green>\d+),\s*(?<blue>\d+)\)/)
        .groups;

      const componentToHex = c => {
        const hex = parseInt(c).toString(16);
        return hex.length == 1 ? '0' + hex : hex;
      };

      return '#' + componentToHex(red) + componentToHex(green) + componentToHex(blue);
    };

    const $body = $('body').on({
      mousedown: (e) => {
        e.preventDefault();
        drawing = true;
      },
      mouseup: () => drawing = false,
      keydown: key(true),
      keyup: key(false),
    });
    for (let hue = 0; hue <= 360; hue += 36) {
      $('<input type="button"/>')
        .css({backgroundColor: `hsl(${hue}, 100%, 50%)`})
        .on('click', e => $('#color').val(rgbToHex(getComputedStyle(e.target).backgroundColor)))
        .appendTo($body);
    }
    const $table = $('<table>').appendTo($body);
    const time = 20;
    const $time = $(`<input type="number" value="${time}">`).appendTo($body);
    console.log('kek');
    let index = 0;
    const colors = [];
    const frameIndex = frames.push({
      colors,
      time,
    }) - 1;
    const initialColor = '#000000';

    const updateColor = (index, color) => {
      frames[frameIndex].colors[index] = color;
      refreshResult();
    };
    for (let x = 0; x < 4; x++) {
      const $row = $('<tr>').appendTo($table);
      for (let y = 0; y < 4; y++) {
        const colorIndex = index++;
        colors[colorIndex] = initialColor;

        const draw = e => {
          const color = $('#color').val();
          $(e.target).css({'background-color': color});
          colors[colorIndex] = color;
          updateColor(colorIndex, color);
        };
        $(`<td>${colorIndex}</td>`)
          .appendTo($row)
          .css({
            width: 20,
            height: 20,
          })
          .on({
            mousemove: e => {
              if (drawing) {
                draw(e);
              }
            },
            mousedown: draw,
          })
          .css({
            'background-color': initialColor,
          });
      }
    }
  });
</script>
</body>
</html>